\documentclass{jsarticle}
\title{LISP on \TeX{} マニュアルもどき}
\author{@hak7a3}
\usepackage{lisp}
\begin{document}
\maketitle
\section{はじめに}
こんなネタを投げてみたことがある．
\begin{quote}
 \TeX{}によるプログラムは，文書を効率的に見た目よく組版するために必須の
 技術であるが，\TeX{}の文法や意味論などにおける複雑さから敷居
 \verb|^H^H|\footnote{木枝祐介氏の指摘により修正．感謝}ハード
 ルが高い．以前からこれに対する解決案として，他言語に解を求めるものが示されている．
 LISPによる\TeX{}のプリプロセッサ［Iwasaki '02］やLuaTeXなどがそれにあた
 る．前者の研究は，既存の\TeX{}資源を有効に使える利点があるが，Emacsに依
 存するためTeXShopなどの近代的な編集環境に適用しづらい．
 後者はpTeXの資源を使うためにやや工夫が必要である．そこで本研究では外部
 環境に依存しない，既存の環境を有効利用できる平易な\TeX{}プログラミング
 環境として，\TeX{}上での言語処理系の実装手法を提案する．
 本手法によりユーザ，特にプログラミング言語の知識があるプログラマはより
 簡単に\TeX{}を効率的に利用することができる．また，本研究は\TeX{}がチュー
 リング完全な言語であるという（忘れられた）事実をすべての\TeX{}ユーザに
 啓蒙するための手段となる．
\end{quote}
やってみた．
\section{文法}
LISP on TeX の文法は，（まだ変わるかもしれないけど）次のとおりです．
\begin{eqnarray*}
  \mbox{s-expr} &::=& \mbox{symbol} \;\; | \;\; \mbox{nil} \;\; | \;\; \mbox{list} \;\; | \;\; \mbox{dot-expr} \;\; | \;\; \mbox{int}
  \;\; | \;\; \mbox{srting} \;\; | \;\; \mbox{bool}\\
  \mbox{symbol}  &::=& \mbox{control-sequence} \;\; | \;\; \mbox{control-symbol}\\
  \mbox{nil}     &::=& \mbox{\texttt{()}}\\
  \mbox{list}    &::=& \texttt{(}\mbox{s-expr}+\texttt{)}\\
  \mbox{dot-expr}&::=& \texttt{(}\mbox{s-expr}\texttt{.}\mbox{s-expr}\texttt{)}\\
  \mbox{int}     &::=& \texttt{:}\mbox{integer}\\
  \mbox{string}  &::=& \texttt{'}\mbox{\TeX{}-token}*\texttt{'}\\
  \mbox{bool}    &::=& \texttt{/}\{\texttt t\;\; | \;\; \texttt f\}\\
\end{eqnarray*}
integerやらcontrol-sequenceやらは\TeX{}の世界の言葉として認識してくれる
と嬉しいです．

現状，スペシャルフォーム的な何かとして機能するものは次のとおりです．
\begin{quote}
 \ttfamily
 quote, if, define, lambda
\end{quote}
このうち，注意が必要な物は\texttt{define}と\texttt{lambda}です．
\texttt{define}は常にグローバル環境の変更としてみなされます．ローカル環
境へは手出ししません．\texttt{lambda}は一引数関数のみサポートしています．
そのため，適当にカリー化する必要があります．また，一引数関数しか定義でき
ない関係上，引数部の括弧を省略します．すなわち，\verb|(\lambda \x (\+ x　1)|
などと記述することになります．
\section{サンプル}
インタフェースとして，\string\lispinterpl 命令を定義してあります．引数に
任意個のs-exprを書けます．dviへの出力は\string\print 関数を用いると嬉し
いです．簡単な例を示します．
\begin{quote}
 \begin{verbatim}
 \lispinterpl{
  (\define \sum (\lambda \n (\if (\= \n :0) \n (\+ \n (\sum (\- \n :1))))))
  (\print (\sum :10))}
 \end{verbatim}
\end{quote}
\begin{quote}
\lispinterpl{
  (\define \sum (\lambda \n (\if (\= \n :0) \n (\+ \n (\sum (\- \n :1))))))
  (\print (\sum :10))}
\end{quote}
\end{document}